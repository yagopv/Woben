define(["durandal/system"],function(e){var t=/\s+/,n=function(){},r=function(e,t){this.owner=e,this.events=t};return r.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},r.prototype.on=r.prototype.then,r.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,a){var i,o,s;if(n){for(i=this.callbacks||(this.callbacks={}),e=e.split(t);o=e.shift();)s=i[o]||(i[o]=[]),s.push(n,a);return this}return new r(this,e)},n.prototype.off=function(n,r,a){var i,o,s,l;if(!(o=this.callbacks))return this;if(!(n||r||a))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(o);i=n.shift();)if((s=o[i])&&(r||a))for(l=s.length-2;l>=0;l-=2)r&&s[l]!==r||a&&s[l+1]!==a||s.splice(l,2);else delete o[i];return this},n.prototype.trigger=function(e){var n,r,a,i,o,s,l,c;if(!(r=this.callbacks))return this;for(c=[],e=e.split(t),i=1,o=arguments.length;o>i;i++)c[i-1]=arguments[i];for(;n=e.shift();){if((l=r.all)&&(l=l.slice()),(a=r[n])&&(a=a.slice()),a)for(i=0,o=a.length;o>i;i+=2)a[i].apply(a[i+1]||this,c);if(l)for(s=[n].concat(c),i=0,o=l.length;o>i;i+=2)l[i].apply(l[i+1]||this,s)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n});