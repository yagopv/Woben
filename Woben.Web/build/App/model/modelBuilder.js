define(["services/appsecurity","services/utils"],function(e,t){function n(e){r(e),a(e),i(e)}function r(n){var r=function(){this.articleId=ko.observable(breeze.core.getUuid()),this.imageUrl=ko.observable("/Content/icons/no_photo.png"),this.createdBy=ko.observable("undefined"!=typeof e.userInfo()?e.userInfo().userName:""),this.updatedBy=ko.observable("undefined"!=typeof e.userInfo()?e.userInfo().userName:""),this.isPublished=ko.observable(!1);var n=t.getCurrentDate();this.createdDate=ko.observable(n),this.updatedDate=ko.observable(n)};r.prototype.addTag=function(e){var t=this.entityAspect.entityManager.createEntity("Tag",{name:e,articleId:this.articleId()});return this.tags.push(t),t},r.prototype.deleteTag=function(e){o(e,"Tag"),this.throwIfNotOwnerOf(e),e.entityAspect.setDeleted()},r.prototype.throwIfNotOwnerOf=function(e){if(!e.articleId||e.articleId()!==this.articleId())throw new Error("Object is not associated with current Article")};var a=function(e){s(e),l(e),e.splitTags=ko.computed(function(){var t=[];return ko.utils.arrayForEach(e.tags(),function(e){t.push(e.name())}),t.join(",")}),e.formattedCreatedDate=ko.computed(function(){return moment(e.createdDate()).format("MMM Do YY")}),e.unsavedChanges=ko.observable(e.entityAspect.entityState.isAddedModifiedOrDeleted())};n.registerEntityTypeCtor("Article",r,a)}function a(e){var t=function(){this.categoryId=ko.observable(breeze.core.getUuid())};e.registerEntityTypeCtor("Category",t)}function i(e){var t=function(){this.tagId=ko.observable(breeze.core.getUuid())};e.registerEntityTypeCtor("Tag",t)}function o(e,t){if(!e.entityType||e.entityType.shortName!==t)throw new Error("Object must be an entity of type "+t)}function s(e){var t,n,r,a,i,o,s,l,d=e.entityType;if(d){for(t=0;t<d.dataProperties.length;t+=1){for(n=d.dataProperties[t],r=n.name,a=e[r],i=[],o=0;o<n.validators.length;o+=1)s=n.validators[o],l={propertyName:r,validator:function(e){var t=this.innerValidator.validate(e,{displayName:this.propertyName});return this.message=t?t.errorMessage:"",null===t},message:"",innerValidator:s},i.push(l);a.extend({validation:i})}for(t=0;t<d.foreignKeyProperties.length;t+=1){for(n=d.foreignKeyProperties[t],r=n.name,a=e[r],i=[],o=0;o<n.validators.length;o+=1)s=n.validators[o],l={propertyName:r,validator:function(e){var t=this.innerValidator.validate(e,{displayName:this.propertyName});return this.message=t?t.errorMessage:"",null===t},message:"",innerValidator:s},i.push(l);a.extend({validation:i}),n.isNullable||a.extend({notEqual:c})}}}function l(e){var t=ko.observable(!1),n=function(){var n=e.entityAspect.getValidationErrors().length>0;t()===n?t.valueHasMutated():t(n)};n(),e.entityAspect.validationErrorsChanged.subscribe(n),e.hasValidationErrors=t}var c=0,d={extendMetadata:n};return d});