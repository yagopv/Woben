define(["durandal/app","services/routeconfig","services/appsecurity"],function(e,t,n){function r(){return new l}function a(){return s.fetchMetadata().then(function(){c.modelBuilder&&c.modelBuilder(s.metadataStore);var e=breeze.EntityQuery.from(t.lookupUrl);return s.executeQuery(e)}).fail(function(e){console.log(e)})}breeze.NamingConvention.camelCase.setAsDefault();var i=breeze.config.getAdapterInstance("ajax");i.defaultSettings={headers:n.getSecurityHeaders()};var o="/breeze",s=new breeze.EntityManager(o),l=function(){var t=function(){var t;this.manager=function(){return t||(t=s.createEmptyCopy(),t.importEntities(s.exportEntities()),t.hasChangesChanged.subscribe(function(){e.trigger("hasChanges")})),t}};return t}(),c={prepare:a,create:r};return c});