define(["services/entitymanagerprovider","services/repository","services/privatearticlerepository","services/publicarticlerepository","durandal/app","services/routeconfig"],function(e,t,n,r,a,i){function o(){return new u}function s(e){return c[e]||(c[e]=new d),c[e]}function l(){for(key in c)0==c[key].referenceCount&&delete c[key]}var c={},u=function(){var o=function(){var o=e.create();this.hasChanges=function(){return o.manager().hasChanges()},this.commit=function(){var e=new breeze.SaveOptions({resourceName:i.saveChangesUrl});return o.manager().saveChanges(null,e).then(function(e){a.trigger("saved",e.entities)})},this.rollback=function(){o.manager().rejectChanges()},this.privatearticles=n.create(o,"Article",i.privateArticlesUrl),this.publicarticles=r.create(o,"Article",i.publicArticlesUrl),this.categories=t.create(o,"Category",i.categoriesUrl,breeze.FetchStrategy.FromLocalCache)};return o}(),d=function(){var e=function(){var e=null;this.referenceCount=0,this.value=function(){return null===e&&(e=new u),this.referenceCount++,e},this.clear=function(){e=null,this.referenceCount=0,l()}};return e.prototype.release=function(){this.referenceCount--,0===this.referenceCount&&this.clear()},e}();return{create:o,get:s}});