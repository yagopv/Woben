define(["services/appsecurity","plugins/router","services/errorhandler"],function(e,t,r){var n=ko.observable().extend({required:!0}),a=ko.observable().extend({required:!0,email:!0}),i=ko.observable().extend({required:!0,minLength:6}),o=ko.observable().extend({required:!0,minLength:6,equal:i}),s={username:n,email:a,password:i,confirmpassword:o,activate:function(){ga("send","pageview",{page:window.location.href,title:document.title})},register:function(){var r=this;return 0!=this.errors().length?(this.errors.showAllMessages(),void 0):(e.register({userName:r.username(),eMail:r.email(),password:r.password(),confirmPassword:r.confirmpassword()}).done(function(){e.login({grant_type:"password",username:r.username(),password:r.password()}).done(function(n){n.userName&&n.access_token&&(e.setAuthInfo(n.userName,n.roles,!1,n.access_token,r.rememberMe),r.username(""),r.email(""),r.password(""),r.confirmpassword(""),r.errors.showAllMessages(!1)),t.navigate("account/manage")}).fail(r.handleauthenticationerrors)}).fail(r.handlevalidationerrors),void 0)}};return r.includeIn(s),s.errors=ko.validation.group(s),s});