define(["services/unitofwork","services/errorhandler","plugins/router"],function(e,t,r){function n(e,t){var r=breeze.Predicate.create("isPublished","==",!0);if(e){var n=breeze.Predicate.create("title",breeze.FilterQueryOp.Contains,e).or(breeze.Predicate.create("description",breeze.FilterQueryOp.Contains,e));r=r.and(n)}return t&&(r=r.and(breeze.Predicate.create("categoryId","==",t))),r}var e=e.create(),a={convertRouteToHash:r.convertRouteToHash,search:ko.observable(""),selectedCategory:ko.observable(""),page:ko.observable(0),count:ko.observable(10),categories:ko.observableArray(),articles:ko.observableArray(),activate:function(){ga("send","pageview",{page:window.location.href,title:document.title})},attached:function(){var t=this;Stashy.OffCanvas("#articles .st-offcanvas",{closeOnClickOutside:!1}).layout(),$("#articles .st-offcanvas").animate({opacity:1},500);var r=e.publicarticles.find(n(t.search(),t.selectedCategory()),t.page(),t.count()).then(function(e){t.articles(e)}),a=e.categories.all().then(function(e){t.categories(e)});return Q.all([r,a]).fail(t.handleError)},evaluateKey:function(){return"keypress"==event.type&&13==event.keyCode&&this.searchArticles(!1),!0},changeSelectedCategory:function(e,t){t.selectedCategory(e.categoryId()),t.searchArticles(!1)},removeSelectedCategory:function(){this.selectedCategory(""),this.searchArticles(!1)},loadMoreArticles:function(){this.page(this.page()+1),this.searchArticles(!0)},searchArticles:function(t){var r=this;t||r.page(0),e.publicarticles.find(n(r.search(),r.selectedCategory()),r.page(),r.count()).then(function(e){t?ko.utils.arrayForEach(e,function(e){r.articles.push(e)}):r.articles(e),e.length<r.count()?$("#btn-loadmore").addClass("disabled"):$("#btn-loadmore").removeClass("disabled")})}};return t.includeIn(a),a});